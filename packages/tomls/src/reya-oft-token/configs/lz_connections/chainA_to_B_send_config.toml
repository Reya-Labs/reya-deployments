# Generic Source Configuration
# Configure chainA endpoint for sending messages to chainB
# This file is reused for both directions with different variable mappings

################################# Set Messaging Libraries #######################################

# Set Send Library (Source -> Destination)
[invoke.lz_set_source_send_library]
target = ["<%= settings.chainAEndpointAddress %>"]
abi = "[{\"inputs\":[{\"internalType\":\"address\",\"name\":\"oapp\",\"type\":\"address\"},{\"internalType\":\"uint32\",\"name\":\"eid\",\"type\":\"uint32\"},{\"internalType\":\"address\",\"name\":\"newLib\",\"type\":\"address\"}],\"name\":\"setSendLibrary\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"}]"
from = "<%= settings.owner %>"
func = "setSendLibrary"
args = [
    "<%= settings.chainAOAppAddress %>",
    "<%= settings.chainBEid %>",
    "<%= settings.chainASendLibAddress %>"
]
depends = ["invoke.reya_token_initialize"]

# Set Receive Library (Destination -> Source)
[invoke.lz_set_source_receive_library]
target = ["<%= settings.chainAEndpointAddress %>"]
abi = "[{\"inputs\":[{\"internalType\":\"address\",\"name\":\"oapp\",\"type\":\"address\"},{\"internalType\":\"uint32\",\"name\":\"eid\",\"type\":\"uint32\"},{\"internalType\":\"address\",\"name\":\"newLib\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"gracePeriod\",\"type\":\"uint256\"}],\"name\":\"setReceiveLibrary\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"}]"
from = "<%= settings.owner %>"
func = "setReceiveLibrary"
args = [
    "<%= settings.chainAOAppAddress %>",
    "<%= settings.chainBEid %>",
    "<%= settings.chainAReceiveLibAddress %>",
    "<%= settings.lzGracePeriod %>"
]
depends = ["invoke.lz_set_source_send_library"]

################################# Set Send Configuration #######################################

# On Source Endpoint, set Destination DVN and Executor config for outbound messages
[invoke.lz_set_source_send_config]
target = ["<%= settings.chainAEndpointAddress %>"]
abi = "[{\"inputs\":[{\"internalType\":\"address\",\"name\":\"oapp\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"lib\",\"type\":\"address\"},{\"components\":[{\"internalType\":\"uint32\",\"name\":\"eid\",\"type\":\"uint32\"},{\"internalType\":\"uint32\",\"name\":\"configType\",\"type\":\"uint32\"},{\"internalType\":\"bytes\",\"name\":\"config\",\"type\":\"bytes\"}],\"internalType\":\"struct SetConfigParam[]\",\"name\":\"params\",\"type\":\"tuple[]\"}],\"name\":\"setConfig\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"}]"
from = "<%= settings.owner %>"
func = "setConfig"
args = [
    "<%= settings.chainAOAppAddress %>",
    "<%= settings.chainASendLibAddress %>",
    [
        {eid = "<%= settings.chainBEid %>", configType = 1, config = "0x0000000000000000000000000000000000000000000000000000000000002710000000000000000000000000<%= settings.chainAExecutorAddress.slice(2) %>"},
        {eid = "<%= settings.chainBEid %>", configType = 2, config = "0x0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000<%= settings.chainBLzConfirmations %>000000000000000000000000000000000000000000000000000000000000000<%= settings.lzRequiredDVNCount %>000000000000000000000000000000000000000000000000000000000000000<%= settings.lzOptionalDVNCount %>000000000000000000000000000000000000000000000000000000000000000<%= settings.lzOptionalDVNThreshold %>00000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000<%= settings.lzRequiredDVNCount %>000000000000000000000000<%= settings.chainALzRequiredDVN1.slice(2) %>0000000000000000000000000000000000000000000000000000000000000000"}
    ]
]
depends = ["invoke.lz_set_source_receive_library", "var.lz_common_config", "var.layerzero_chainA_config", "var.layerzero_chainB_config"]

