[var.usdt_vars]
usdtTokenName = "Tether USD"
usdtTokenSymbol = "USDT"
usdtTokenDecimals = "6"

[clone.usdt]
source = "reya-tokens:1.0.0@proxy"
targetPreset = "usdt"
options.owner = "<%= settings.owner %>"
options.salt = "<%= settings.usdt_salt %>"
depends = [
  "var.initial_proxy_vars",
]

# Upgrades implementation of InitialProxy to point to the new
# router implementation.
[invoke.upgrade_usdt_proxy]
target = ["usdt.InitialProxy"]
fromCall.func = "owner"
func = "upgradeTo"
args = ["<%= imports.reyaTokenRouter.contracts.TokenRouter.address %>"]
factory.USDTProxy.abiOf = ["reyaTokenRouter.TokenRouter"]
factory.USDTProxy.event = "Upgraded"
factory.USDTProxy.arg = 0
depends = [
  "clone.usdt",
]

[invoke.usdt_initialize]
target = ["USDTProxy"]
fromCall.func = "owner"
func = "initialize"
args = [ 
  "<%= settings.usdtTokenName %>",
  "<%= settings.usdtTokenSymbol %>",
  "<%= settings.usdtTokenDecimals %>",
]
depends = ["invoke.upgrade_usdt_proxy"]

[invoke.usdt_unpause]
target = ["USDTProxy"]
fromCall.func = "owner"
func = "setFeatureFlagAllowAll"
args = [
    "0xb72bd9169e5731cecf365f3aced3ec60a622c3d382d245b60556ef9bd2e43583",
    true
]
depends = ["invoke.upgrade_usdt_proxy"]

# [invoke.usdt_mint_permission]
# target = ["USDTProxy"]
# fromCall.func = "owner"
# func = "addToFeatureFlagAllowlist"
# args = [
#     "0xdaf0b3c5710379609eb5495f1ecd348cb28167711b73609fe565a72734550354",
#     "<%= settings.usdt_controller %>"
# ]
# depends = ["invoke.upgrade_usdt_proxy"]

# [invoke.usdt_burn_permission]
# target = ["USDTProxy"]
# fromCall.func = "owner"
# func = "addToFeatureFlagAllowlist"
# args = [
#     "0xf43e8cfd4725c1e28fa4a6e3e468b4fcf75367166b850ac5f04e33ec843e82c1",
#     "<%= settings.usdt_controller %>"
# ]
# depends = ["invoke.upgrade_usdt_proxy"]